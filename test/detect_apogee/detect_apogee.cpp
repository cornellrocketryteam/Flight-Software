/**
 * @file detect_apogee.cpp
 * @author csg83
 * 
 * @brief Unit test of the algorithm to detect apogee via a simple moving average (SMA)
 */

#include <iostream>

// Apogee is 3459.565 (index 534)
float data[] = { -0.076, -0.006, -0.036, 0.141, 1.434, 1.957, 3.09, 3.912, 5.814, 7.38, 8.925, 11.04, 12.964, 15.951, 18.352, 20.445, 23.105, 26.643, 29.964, 33.709, 37.113, 41.102, 44.728, 49.263, 53.819, 57.937, 63.191, 67.945, 72.55, 78.785, 83.845, 90.337, 96.256, 102.477, 108.109, 114.974, 122.041, 128.885, 136.455, 144.079, 150.681, 158.435, 167.009, 174.495, 183.021, 191.367, 200.051, 209.279, 217.749, 227.779, 236.863, 246.656, 255.806, 266.058, 276.857, 286.941, 297.339, 308.406, 319.184, 329.849, 341.336, 352.652, 364.517, 376.273, 388.16, 399.786, 412.15, 424.627, 436.554, 449.684, 462.608, 475.032, 488.436, 502.416, 515.252, 529.292, 542.421, 556.645, 570.157, 584.083, 598.332, 611.734, 626.248, 639.705, 654.375, 667.977, 682.191, 696.938, 710.956, 724.255, 738.601, 752.205, 766.473, 780.691, 794.846, 808.866, 822.694, 836.818, 850.192, 864.236, 877.933, 892.344, 905.276, 918.841, 932.119, 945.525, 959.361, 972.729, 986.285, 999.355, 1012.587, 1017.875, 1025.271, 1036.325, 1049.536, 1062.801, 1075.567, 1088.093, 1101.442, 1114.215, 1126.789, 1140.061, 1152.707, 1165.684, 1177.583, 1190.299, 1202.959, 1215.274, 1227.761, 1240.289, 1252.611, 1264.314, 1277.078, 1289.311, 1300.621, 1312.866, 1325.038, 1336.349, 1348.767, 1360.94, 1372.745, 1383.849, 1395.181, 1406.57, 1418.976, 1430.368, 1441.704, 1453.358, 1464.841, 1476.499, 1487.143, 1498.932, 1509.394, 1521.243, 1532.705, 1543.117, 1554.306, 1565.284, 1576.347, 1587.413, 1597.897, 1609.556, 1620.143, 1630.451, 1641.191, 1651.718, 1662.484, 1673.296, 1683.826, 1694.606, 1704.829, 1714.856, 1725.672, 1735.655, 1746.37, 1756.551, 1766.427, 1776.234, 1786.676, 1797.195, 1807.525, 1817.06, 1827.11, 1837.448, 1846.847, 1856.92, 1867.141, 1876.672, 1885.585, 1896.244, 1905.927, 1915.08, 1925.345, 1934.327, 1943.882, 1952.87, 1962.803, 1972.752, 1981.831, 1990.785, 2000.427, 2009.464, 2018.981, 2028.125, 2037.424, 2046.765, 2055.769, 2064.157, 2073.547, 2082.435, 2091.395, 2099.85, 2109.383, 2117.741, 2126.765, 2135.824, 2144.595, 2152.516, 2162.047, 2170.337, 2179.267, 2187.514, 2196.073, 2204.085, 2213.27, 2221.351, 2229.804, 2238.123, 2246.444, 2255.029, 2262.885, 2271.514, 2279.599, 2287.898, 2296.086, 2303.339, 2311.385, 2319.824, 2328.091, 2335.771, 2343.726, 2351.393, 2359.209, 2367.443, 2374.765, 2382.877, 2390.618, 2398.585, 2405.913, 2413.956, 2420.958, 2428.594, 2436.043, 2443.408, 2451.229, 2459.154, 2466.196, 2473.236, 2480.356, 2488.229, 2495.148, 2502.52, 2509.952, 2517.548, 2524.894, 2531.431, 2538.81, 2545.485, 2553.075, 2559.685, 2566.84, 2573.621, 2581.065, 2587.593, 2594.18, 2601.0, 2607.369, 2614.992, 2621.255, 2628.336, 2634.689, 2641.478, 2647.696, 2654.948, 2661.447, 2667.983, 2674.121, 2680.95, 2686.897, 2693.63, 2700.311, 2706.796, 2713.019, 2719.176, 2724.885, 2731.237, 2737.602, 2743.605, 2749.916, 2756.438, 2762.538, 2767.768, 2773.661, 2780.137, 2785.936, 2792.028, 2798.048, 2804.799, 2809.995, 2815.603, 2821.651, 2827.748, 2832.965, 2839.414, 2844.191, 2850.039, 2855.692, 2861.112, 2867.116, 2873.021, 2877.884, 2883.817, 2889.116, 2894.192, 2899.664, 2905.175, 2910.427, 2915.953, 2921.19, 2926.361, 2931.584, 2936.98, 2942.417, 2947.813, 2952.272, 2957.399, 2962.434, 2968.116, 2972.602, 2977.79, 2983.173, 2987.088, 2992.966, 2997.864, 3002.207, 3006.985, 3012.151, 3016.976, 3021.614, 3026.852, 3030.852, 3035.846, 3040.049, 3044.986, 3050.001, 3054.674, 3058.646, 3063.634, 3067.919, 3072.401, 3076.631, 3081.453, 3084.67, 3089.407, 3094.376, 3097.756, 3102.135, 3106.774, 3110.438, 3114.629, 3118.767, 3123.56, 3127.873, 3132.16, 3135.773, 3139.172, 3143.064, 3147.696, 3151.417, 3155.515, 3159.272, 3163.518, 3167.427, 3170.645, 3174.852, 3178.713, 3182.622, 3185.965, 3189.168, 3193.493, 3197.209, 3200.963, 3203.806, 3207.689, 3211.337, 3214.68, 3218.406, 3221.526, 3225.321, 3228.257, 3232.211, 3234.915, 3238.7, 3242.135, 3245.871, 3248.332, 3252.214, 3255.084, 3258.371, 3261.09, 3263.916, 3267.993, 3270.85, 3273.417, 3276.471, 3279.308, 3282.576, 3286.269, 3288.977, 3291.676, 3294.15, 3297.243, 3300.39, 3302.969, 3305.399, 3308.355, 3310.785, 3314.098, 3316.64, 3319.158, 3322.011, 3323.923, 3326.432, 3329.708, 3331.938, 3334.859, 3337.248, 3339.079, 3341.75, 3344.032, 3346.938, 3349.088, 3351.298, 3353.632, 3355.889, 3357.945, 3360.566, 3362.37, 3364.929, 3366.441, 3368.88, 3370.3, 3372.898, 3375.228, 3377.463, 3379.295, 3380.712, 3383.394, 3385.397, 3386.993, 3388.466, 3390.378, 3392.15, 3394.077, 3395.789, 3397.668, 3398.855, 3400.686, 3402.661, 3404.41, 3405.946, 3407.149, 3409.287, 3410.808, 3412.611, 3413.634, 3415.383, 3416.896, 3417.338, 3419.077, 3420.82, 3422.117, 3423.547, 3425.007, 3425.879, 3427.308, 3428.311, 3430.218, 3431.378, 3432.099, 3433.298, 3434.653, 3435.061, 3436.607, 3437.743, 3438.725, 3439.536, 3440.786, 3441.388, 3442.6, 3442.733, 3444.177, 3445.01, 3446.033, 3446.805, 3447.363, 3448.186, 3448.706, 3449.33, 3450.026, 3451.03, 3451.765, 3451.869, 3453.179, 3453.384, 3453.336, 3453.96, 3454.536, 3454.617, 3454.831, 3456.374, 3456.416, 3456.832, 3456.942, 3457.296, 3457.313, 3457.618, 3457.77, 3458.384, 3458.79, 3458.907, 3458.58, 3459.565, 3458.983, 3458.421, 3459.493, 3459.532, 3459.177, 3458.985, 3458.722, 3457.44, 3454.492, 3448.934, 3443.434, 3437.636, 3430.891, 3422.271, 3412.255, 3401.202, 3389.312, 3377.287, 3365.633, 3352.595, 3340.34, 3327.528, 3315.128, 3302.523, 3290.41, 3277.161, 3265.25, 3252.543, 3240.19, 3228.065, 3215.834, 3202.947, 3190.633, 3177.963, 3164.613, 3152.533, 3140.114, 3127.974, 3115.58, 3103.196, 3090.505, 3078.701, 3065.779, 3053.664, 3041.024, 3028.258, 3016.243, 3004.478, 2991.562, 2979.702, 2967.657, 2954.725, 2942.521, 2930.882, 2917.731, 2905.068, 2893.118, 2881.355, 2868.9, 2855.346, 2843.743, 2831.387, 2820.021, 2807.583, 2795.184, 2782.777, 2770.326, 2758.332, 2746.847, 2734.011, 2722.783, 2710.199, 2698.205, 2685.297, 2673.869, 2661.414, 2648.967, 2636.826, 2624.952, 2612.391, 2600.403, 2588.823, 2576.851, 2564.52, 2552.631, 2540.587, 2528.18, 2516.361, 2504.003, 2492.24, 2479.842, 2468.077, 2456.092, 2444.058, 2431.616, 2420.013, 2408.166, 2396.474, 2383.658, 2372.304, 2359.834, 2348.793, 2336.264, 2324.302, 2312.242, 2300.508, 2288.511, 2276.947, 2264.622, 2252.977, 2241.234, 2228.627, 2217.291, 2205.628, 2193.637, 2181.401, 2170.099, 2157.975, 2147.068, 2134.72, 2122.573, 2110.541, 2099.706, 2087.102, 2074.835, 2063.278, 2052.017, 2039.823, 2028.456, 2016.38, 2004.576, 1992.999, 1981.727, 1969.607, 1958.13, 1946.868, 1934.574, 1922.856, 1910.929, 1899.386, 1887.508, 1876.266, 1864.694, 1853.083, 1841.25, 1829.453, 1818.19, 1806.412, 1794.821, 1782.988, 1772.041, 1760.929, 1748.273, 1736.824, 1724.876, 1713.568, 1702.089, 1690.521, 1679.328, 1667.669, 1655.778, 1644.411, 1633.097, 1621.426, 1609.794, 1598.185, 1586.323, 1575.222, 1564.257, 1552.55, 1540.867, 1529.987, 1518.137, 1506.663, 1494.731, 1483.562, 1471.95, 1460.031, 1449.679, 1437.562, 1426.066, 1414.815, 1403.9, 1392.266, 1380.849, 1369.722, 1358.127, 1347.353, 1334.44, 1323.738, 1312.847, 1301.163, 1290.012, 1278.911, 1267.148, 1255.945, 1244.966, 1233.794, 1222.059, 1210.825, 1199.435, 1188.34, 1177.267, 1165.565, 1154.663, 1143.535, 1131.957, 1120.871, 1109.309, 1097.854, 1086.797, 1075.589, 1064.796, 1053.918, 1042.341, 1030.864, 1020.284, 1009.724, 997.737, 986.374, 975.95, 964.426, 952.944, 942.171, 930.492, 919.805, 908.1, 897.288, 886.332, 875.133, 864.062, 853.43, 841.704, 830.459, 820.686, 809.282, 798.054, 786.54, 775.628, 763.793, 753.671, 742.562, 731.883, 720.32, 709.423, 697.849, 687.641, 676.525, 665.577, 654.048, 643.037, 632.74, 621.27, 610.376, 599.108, 588.076, 577.939, 566.828, 556.331, 545.278, 533.667, 522.975, 512.118, 501.048, 490.869, 479.331, 468.33, 457.992, 446.841, 436.258, 425.337, 414.111, 404.131, 392.61, 381.884, 370.888, 360.283, 349.542, 338.473, 327.593, 316.958, 305.947, 295.135, 284.101, 284.87, 284.452, 284.525, 284.155, 284.606, 284.636, 284.038, 284.362, 284.312, 284.128, 283.975, 283.578, 284.441, 284.411, 284.34, 284.302, 283.964, 284.357, 284.083, 283.821, 284.337, 283.302, 284.443, 283.551, 284.024, 283.691, 283.751, 283.935, 283.5, 283.793, 283.712, 283.444, 283.5, 284.091, 283.658, 284.211, 283.638, 283.825, 283.445, 283.531, 283.569, 283.709, 283.309, 283.551, 283.008, 283.457, 283.063, 283.755, 283.488, 283.034, 283.076, 283.493, 283.053, 283.064, 283.368, 283.927, 283.189, 283.828, 283.206, 283.584, 282.738, 283.31, 283.37, 282.766, 282.99, 282.966, 283.579, 283.036, 282.734, 282.414, 282.506, 282.994, 282.984, 282.937, 282.543, 282.277, 283.01, 282.46, 281.937, 282.188, 282.768, 282.421, 282.642, 282.036, 281.929, 282.154, 282.129, 282.037, 282.176, 281.968, 281.93, 282.26, 281.807, 281.948, 281.989, 281.217, 281.528, 281.531, 280.768, 281.099, 280.927, 280.69, 280.95, 281.278, 281.09, 281.343, 281.665, 280.346, 281.008, 280.042, 280.284, 279.785, 279.676, 279.28, 279.526, 279.217, 278.99, 278.404, 278.282, 277.65, 276.775, 275.521, 274.681, 272.775, 271.071, 268.536, 266.7, 266.42, 266.415, 262.904, 259.862, 258.094, 255.125, 252.374, 249.38, 248.813, 247.59, 245.056, 244.009, 242.552, 239.955, 238.078, 236.242, 233.642, 230.716, 228.434, 226.978, 225.488, 225.015, 222.258, 219.543, 215.844, 212.867, 210.028, 207.012, 204.552, 201.859, 199.305, 196.655, 193.368, 190.845, 187.879, 184.847, 183.563, 181.02, 177.394, 177.046, 176.22, 173.14, 170.006, 167.207, 164.115, 161.742, 160.623, 158.506, 156.209, 153.621, 150.662, 147.982, 145.148, 141.939, 140.179, 138.597, 136.201, 133.777, 131.574, 128.479, 125.88, 123.13, 121.146, 117.676, 114.946, 112.197, 109.709, 107.304, 106.857, 105.149, 103.748, 101.869, 99.009, 96.46, 94.855, 93.377, 89.904, 87.924, 84.979, 82.112, 79.313, 75.755, 74.093, 71.398, 68.265, 65.808, 62.952, 60.164, 58.027, 57.502, 54.187, 51.507, 48.265, 46.081, 42.49, 39.778, 38.358, 37.096, 33.849, 30.804, 28.611, 26.399, 22.784, 20.763, 17.873, 15.123, 13.098, 11.522, 8.902, 5.818, 4.35, 0.736, 0.075 };

int main() {
    int size = 10;
    float buffer[size];
    float sum = 0;
    int index = 0;
    float filtered_alt[3] = {-1, -1, -1};
    int interval = 20;
    int count = 0;

    for (unsigned int i = 0; i < size; i++) {
        buffer[i] = 0;
    }

    for (unsigned int i = 0; i < sizeof(data) / sizeof(float); i++) {
        sum -= buffer[index];
        buffer[index] = data[i];
        sum += data[i];

        index++;
        if (index == 10) { index = 0; }

        std::cout << i << ": " << sum * .1 << " (" << data[i] << ")" << std::endl;
        if (count == interval) {
            filtered_alt[2] = filtered_alt[1];
            filtered_alt[1] = filtered_alt[0];
            filtered_alt[0] = sum * .1;
            count = 0;
        }
        count++;

        if (filtered_alt[2] != -1 && filtered_alt[1] != -1 && filtered_alt[0] != -1 &&
            filtered_alt[2] > filtered_alt[1] && filtered_alt[1] > filtered_alt[0]) {
            std::cout << "Apogee Detected" << std::endl;
            return 0;
        }
    }

    return 0;
}