/**
 * @file detect_liftoff.cpp
 * @author csg83
 * 
 * @brief Unit test of the algorithm to detect liftoff via a simple moving average (SMA)
 */

#include <iostream>
#include "../../src/constants.hpp"

float data[] = { 1.056, 0.960, 0.960, 1.008, 0.960, 0.960, 0.960, 0.864, 1.008, 0.864, 1.104, 0.960, 1.008, 0.960, 1.008, 1.008, 1.008, 0.960, 1.008, 1.008, 0.960, 0.912, 1.008, 1.008, 0.960, 0.912, 0.912, 0.960, 0.960, 1.008, 0.960, 0.912, 1.008, 0.960, 1.008, 1.008, 0.960, 1.056, 1.056, 0.912, 1.008, 1.056, 1.056, 1.104, 0.960, 1.008, 1.008, 1.056, 1.008, 0.960, 0.960, 0.960, 1.008, 0.912, 1.056, 1.008, 1.008, 1.104, 1.008, 1.008, 2.6555318030915900, 6.964786770208630, 6.423835439447770, 6.6583701645946800, 5.986469837714620, 6.191797030884100, 6.428789687117690, 6.784424077431530, 6.968666227574740, 6.179307614695020, 7.926953598222500, 7.514929244522840, 6.124906655708290, 7.4279446067470800, 7.670949793517620, 6.619516826064030, 5.9899362743834, 6.49628473262435, 6.587617169123950, 6.3259449776416100, 5.879994704645670, 6.693990751414400, 6.779146400630730, 7.123658126275220, 7.394598384390200, 7.999729884860090, 6.813335486881690, 7.0558650441613500, 7.224095106003630, 7.042570539084190, 6.721089211119660, 7.2807804165293100, 7.678624708017890, 7.524731636868340, 7.4083710947591000, 7.063961819094570, 6.529164340250490, 7.3900697401331800, 7.408419518335890, 7.470736007999400, 7.174736551558490, 7.193876100423020, 7.617075842214120, 8.347126416502350, 7.225549222808750, 7.455610393641650, 7.574647725348510, 8.056809846793270, 8.326326091323580, 7.159849905663030, 7.330802977902890, 7.38839977177754, 6.693564485165800, 7.814678428542140, 7.525336982674970, 7.280560815339220, 6.555392991655450, 8.104235497929740, 6.416313313857970, 7.602595748154700, 6.434224486390620, 7.2738995404548700, 6.930593234495450, 6.353908847890030, 7.37794408250681, 7.7233083197754600, 7.388532030819790, 7.301806946575480, 7.339812816016910, 7.437314165428990, 6.8639310518402300, 7.071126562028870, 6.923109167532270, 7.506159862078050, 6.97017451647772, 7.175363415933000, 6.813781139067290, 6.1724145368436900, 6.5516732138198700, 5.875073854137480, 5.7341536715025500, 5.523422918358840, 5.665735071431360, 5.967463270594110, 6.185091350814890, 6.4416521730788600, 5.967010466119310, 6.582319409225100, 4.882162158324760, 6.98715128636135, 5.709050057909290, 5.018056504161540, 4.364167992236320, 3.4287988790768400, 3.2134889056709500, 2.2324470883020800, 1.7112014148726100, 0.7813958353924880, 1.3812573866185100, 1.6104240004903400, 2.3779276228992100, 1.421891449632580, 0.7663640073296090, 0.6228137440554030, -0.3200966880954940, 0.34192984250797500 };

int main() {
    int size = 10;
    float buffer[size];
    float sum = 0;
    int index = 0;

    for (unsigned int i = 0; i < size; i++) {
        buffer[i] = 0;
    }

    for (unsigned int i = 0; i < sizeof(data) / sizeof(float); i++) {
        sum -= buffer[index];
        buffer[index] = data[i];
        sum += data[i];

        index++;
        if (index == 10) { index = 0; }

        std::cout << i << ": " << sum * .1 << " (" << data[i] << ")" << std::endl;
        if (sum * .1 > constants::accel_threshold) {
            std::cout << "Liftoff detected" << std::endl;
            return 0;
        }
    }

    return 0;
}